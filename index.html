<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Bengt the magic color stealer</title>
	<style type="text/css">
	.clrImgContainer {
		float:left;
		border:2em;
		padding:2em;
	}
	.clrImg {
		width:20em;	
	}
	.imgDataContainer {
		background-color:grey;
		height:2em;
	}
	</style>
</head>
<body>
	<header>
    	<h2 class="section-header">Color make, go!</h2>
		<div class="topBar"></div>
	</header>
	<section class="allTheColors">
		
	</section>
	  <div class="clrImgContainer">
		  <img src="img/1337_crest_grey.jpeg" alt="1337_crest_grey.jpeg" class="clrImg" />
	  </div>
	  <div class="clrImgContainer">
		  <img src="img/3094349742_984f021cf9_o.jpg" alt="3094349742_984f021cf9_o.jpg" class="clrImg" />
	  </div>
	  <div class="clrImgContainer">
		  <img src="img/8419728382_3aa95965f4_o.jpg" alt="8419728382_3aa95965f4_o.jpg" class="clrImg" />
	  </div>
	  <div class="clrImgContainer">
		  <img src="img/Kalle Wallin - Body.jpg" alt="Kalle Wallin - Body.jpg" class="clrImg" />
	  </div>
	  <div class="clrImgContainer">
		  <img src="img/Kalle Wallin - CV.jpg" alt="Kalle Wallin - CV.jpg" class="clrImg" />
	  </div>
	  <div class="clrImgContainer">
		  <img src="img/Kalle Wallin - Wall of leet.jpg" alt="Kalle Wallin - Wall of leet.jpg" class="clrImg" />
	  </div>
	  <div class="clrImgContainer">
		  <img src="img/pande_small.jpg" alt="pande_small.jpg" class="clrImg" />
	  </div>
	  <div class="clrImgContainer">
		  <img src="img/Pandemonium 1 144.jpg" alt="Pandemonium 1 144.jpg" class="clrImg" />
	  </div>
	  <div class="clrImgContainer">
		  <img src="img/The+Autumn+Enigma+autumn.jpg" alt="The+Autumn+Enigma+autumn.jpg" class="clrImg" />
	  </div>
<script src="js/color-thief.js"></script>
<script src="js/imagesloaded.pkgd.js"></script>
<script>
	var maximumNumberOfColorsInPalette = 5;
	var allFoundColors = {};
	function calculateTheImages(callback) {
		imagesLoaded(document.querySelector("body"), function(){
			var tjuven = new ColorThief();
			[].forEach.call(
				document.querySelectorAll('.clrImg'), 
				function(imgElement) {
						try{
							var pal = tjuven.getPalette(imgElement, maximumNumberOfColorsInPalette);
							console.log(pal);
							var dominantDiv = makeColorDiv(pal[0], "dominant");
							addOrIncrementColorCount(pal[0]);
							imgElement.parentElement.appendChild(dominantDiv);
							if (pal[1]){
								pal.slice(1).forEach(function(paletteColor){
					 			  console.log("heya", paletteColor);
					 			  var colorDiv = makeColorDiv(paletteColor, paletteColor.concat());
								  addOrIncrementColorCount(paletteColor);
								  imgElement.parentElement.appendChild(colorDiv); 
				 			 	});
							}
						}
						catch(err){console.log(err);}	
				}
			);
			callback();
		});
	}
	function addOrIncrementColorCount(rgbArray){
		var assocName = rgbArray.concat().toString().replace(/,/g,"_");
		if (!allFoundColors[assocName]){
			allFoundColors[assocName] = {
				r: rgbArray[0],
				g: rgbArray[1],
				b: rgbArray[2],
				count:1
			};
			console.log("created entry", assocName);
		}
		else {
			allFoundColors[assocName].count += 1;
			console.log("added count to", assocName);
		}
	}
function makeColorDiv(rgbArray, description) {
	var colorDiv = document.createElement("div");
	console.log(rgbArray.concat());
	colorDiv.className = "clrDiv";
 	colorDiv.style.background = "rgb(" + rgbArray.concat() + ")";
 	colorDiv.innerHTML = description;	
 	return colorDiv;
};
function printHeadResult(){
	document.querySelector(".allTheColors").innerHTML = allFoundColors.toString();
	console.log(sortTheResults());
}
function sortTheResults(){
	var sortable = [];
	for (var color in allFoundColors){
	      sortable.push([color, allFoundColors[color].count]);
		  console.log("sorting", color, allFoundColors[color].count);
	}
	sortable.sort(function(a, b) {return b[1] - a[1]});
	return sortable;
}
calculateTheImages(printHeadResult);
</script>
</body>
</html>
